# 2.0 FEATURES IMPLEMENTED

This document lists the **main features** implemented in the Device Owner app.

---

## 1. Device Owner and device admin

- Provisioning as **Device Owner** (QR code / managed provisioning).  
- **Device admin** receiver for policy and provisioning intents.  
- **DeviceOwnerManager**: security modes (STANDARD / STRICT), user restrictions, factory reset block, system update policy, set default launcher.  
- **SilentDeviceOwnerManager**: apply restrictions silently (no user-facing dialogs).  
- **Complete Silent Mode**: hide management messages when Device Owner.

---

## 2. Device registration

- **Loan number** entry (DeviceRegistrationActivity) with validation (LoanNumberValidator).  
- **Device data collection** (IMEI, model, storage, etc.) and user verification screen.  
- **Backend registration**: POST api/devices/mobile/register/; store device_id for all subsequent API calls.  
- **Registration error viewer** for saved error files (e.g. HTML) in DeviceOwner/RegistrationErrors.

---

## 3. Heartbeat and sync

- **30-second heartbeat** via SecurityMonitorService + HeartbeatService (in-process).  
- **HeartbeatWorker** for one-off heartbeat (e.g. deactivation flow) with retry.  
- Payload: device info, security flags, location, battery, nested maps (device_info, android_info, etc.).  
- **Server response handling**: lock/unlock, deactivation (loan complete / payment complete), next_payment, tamper_indicators, instructions.  
- **Offline sync**: OfflineEvent queue + OfflineSyncWorker when network returns.

---

## 4. Hard lock and soft lock

- **Hard lock**: Full kiosk (HardLockActivity); DevicePolicyManager.lockNow(); persists across reboot; used on server lock or tamper.  
- **Soft lock**: Dismissible overlay (SoftLockOverlayService) for payment reminder and SIM change warning.  
- Lock state in SharedPreferences and device-protected storage for boot.  
- **RemoteDeviceControlManager**: applyHardLock(), applySoftLock(), getLockStateForBoot().

---

## 5. Tamper detection and response

- **TamperBootChecker**: On boot, check developer options, USB debugging, bootloader → hard lock + tamper report.  
- **SecurityMonitorService**: Runtime checks every 2s (developer options, USB, tamper) and 500ms (Settings in foreground).  
- **DeviceOwnerRemovalDetector**: Every 5s check Device Owner status → hard lock + remote wipe if removed.  
- **AccessibilityGuard**: Unauthorized accessibility services → soft lock.  
- **SIMChangeDetector**: SIM change → overlay + tamper report (SIM_CHANGE).  
- **PackageRemovalReceiver**: Package removed/replaced → tamper (PACKAGE_REMOVED).  
- **EnhancedAntiTamperResponse**: Central handler — hard lock first, then POST tamper to server (or queue offline).

---

## 6. Security and restrictions

- **User restrictions**: Factory reset, safe boot, add/remove user, unknown sources, config WiFi/mobile/Bluetooth, mount physical media; STRICT adds debugging features, USB file transfer.  
- **FRP** (Factory Reset Protection): FrpManager, FrpPolicyManager, FrpStatusActivity.  
- **Enforcement**: AdbBlocker, BootloaderLockEnforcer, CustomRomBlocker, EnhancedSecurityManager, PowerButtonBlocker.  
- **FirmwareSecurityMonitorService**: Firmware/integrity monitoring.

---

## 7. Logs and bug reporting

- **LogManager**: Categorized local logs (registration, heartbeat, security, provisioning, sync, errors, etc.) under DeviceOwnerLogs/.  
- **ServerBugAndLogReporter**: postLog() for tech API (POST api/tech/devicecategory/logs/), postBug() and postException() (POST api/tech/devicecategory/bugs/).  
- **Remote log callback**: Error/Warning logs also sent to server.  
- **Global exception handler**: Uncaught exceptions reported via postException().

---

## 8. Local data and databases

- **DeviceOwnerDatabase** (Room): registration, heartbeat history, tamper, offline queue (OfflineEvent), lock state records, SIM change history.  
- **SharedPreferences**: device_id, lock state, security mode, control_prefs, device_locks.

---

## 9. Auto-update (agent update)

- **GitHubUpdateManager**: Fetch latest release from GitHub, download APK, install silently (Device Owner).  
- **UpdateScheduler** + **UpdateCheckWorker**: Periodic check (e.g. every 6 hours).  
- **UpdateConfig**: GitHub owner/repo, APK asset name, intervals, notification channel.  
- **UpdateReceiver**: Install-complete callback.

---

## 10. Provisioning and compatibility

- **DeviceOwnerCompatibilityChecker**: Android 13+, stock Android or supported manufacturer.  
- **Provisioning flow**: DataPrivacyConsent, DeviceCompatibilityCheck, ProvisioningProgress, CompatibilitySuccess/Failure, PolicyCompliance.  
- **Installation status API**: POST installation-status when setup completes or fails.

---

## 11. Deactivation

- **DeviceOwnerDeactivationManager** / **DeactivationHandler**: When server signals loan complete (payment_complete, loan_complete, loan_status, deactivation.status).  
- Removes Device Owner, clears restrictions, and allows normal device use.

---

## 12. UI and lock screens

- **RegistrationStatusActivity** (launcher), **MainActivity**, **RegistrationSuccessActivity**, **DeviceDataCollectionActivity**, **FrpStatusActivity**.  
- **HardLockActivity** (kiosk), **EnhancedSoftLockActivity**, **SIMChangeOverlayActivity**.  
- **LockScreenStrategy**, **LockScreenManager**, **PinEntryScreen** (PIN entry for unlock when used).  
- **LocalDataServerService**: Local HTTP server for device data (e.g. JSON) for debugging.

---

Related: [1.0 Device Owner Overview](1.0-DEVICE-OWNER-OVERVIEW.md), [6.0 APIs](6.0-APIS.md), [3.0 Compatibility](3.0-COMPATIBILITY.md).
