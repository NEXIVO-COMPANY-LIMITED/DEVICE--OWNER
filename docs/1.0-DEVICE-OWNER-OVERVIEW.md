# 1.0 DEVICE OWNER — OVERVIEW

## Project objective

The **objective** of this project is to deliver an **Android Device Owner application** that:

- Secures and controls **loan-backed or asset-backed devices** so the lender/operator can enforce policy, monitor status, and protect the asset until the loan is complete.
- Runs with **Device Owner** and **Device Admin** privileges so the app can apply system-level restrictions and survive user tampering within Android’s model.
- Integrates with a **backend** for registration, heartbeat, lock/unlock, tamper reporting, and deactivation so the fleet is manageable from one place.

## What the project must deliver

The project is required to deliver the following. Nothing in this list is optional for the core product:

| # | Deliverable | Description |
|---|-------------|-------------|
| 1 | **Device registration** | Loan number entry, device data collection (IMEI, model, etc.), and backend registration returning a stable `device_id` for all future API calls. |
| 2 | **30-second heartbeat** | Sending device telemetry and status to the backend at a fixed 30s interval; processing server responses (lock, deactivate, next_payment, tamper_indicators). |
| 3 | **Hard lock** | Full kiosk-style lock (e.g. HardLockActivity) on server command or tamper; persists across reboot. |
| 4 | **Soft lock** | Dismissible overlay for payment reminder or SIM-change warning, without full kiosk. |
| 5 | **Tamper detection and response** | Detecting developer options, USB debugging, bootloader unlock, root, SIM change, app removal, etc.; applying hard lock and reporting tamper events to the backend. |
| 6 | **Security hardening** | Restricting factory reset, unknown sources, and other high-risk actions; optional STRICT mode (no ADB). |
| 7 | **Offline resilience** | Queuing events (e.g. tamper, logs) when offline and syncing when the network returns. |
| 8 | **Deactivation** | Clean deactivation when the loan is complete (server or user trigger), returning the device to an unmanaged state. |
| 9 | **Auto-update** | Optional self-update from a trusted source (e.g. GitHub Releases) using Device Owner privileges. |
| 10 | **Backend integration** | APIs for registration, heartbeat, installation status, tamper, logs, and bugs as defined in 6.0 APIs. |

These deliverables define the **minimum** the project must achieve; additional features (e.g. FRP, Knox roadmap) extend this base.

## Purpose (how the app works)

The app fulfils the objective by:

- **Loan/asset-backed device control**: Devices are tied to a loan; the app enforces security, reports status, and supports remote lock/unlock and deactivation when the loan is complete.
- **Security hardening**: Restricts factory reset, developer options, USB debugging, unknown sources, and other high-risk actions.
- **Tamper detection and response**: Detects bootloader unlock, root, developer mode, USB debug, SIM change, and similar events; applies hard lock and reports to the backend.
- **Heartbeat and sync**: Sends device data to the backend at a fixed interval (e.g. 30 seconds) and processes server instructions (lock, deactivation, etc.).
- **Silent operation**: Management messages can be suppressed (Complete Silent Mode) so the user does not see policy dialogs.

## Architecture Summary

| Layer | Responsibility |
|-------|----------------|
| **Device Owner / Device Admin** | `DeviceOwnerManager`, `SilentDeviceOwnerManager`, `AdminReceiver` — policy application, compatibility, silent restrictions |
| **Security & tamper** | `TamperBootChecker`, `EnhancedAntiTamperResponse`, `SIMChangeDetector`, `DeviceOwnerRemovalDetector`, `AccessibilityGuard` — detect and respond to tamper |
| **Monitoring & heartbeat** | `SecurityMonitorService`, `HeartbeatService`, `HeartbeatWorker` — foreground monitoring, 30s heartbeat, policy checks |
| **Lock control** | `RemoteDeviceControlManager`, `HardLockManager`, `SoftLockOverlayService` — soft lock overlay, hard lock (kiosk) |
| **Registration & data** | `DeviceRegistrationRepository`, `DeviceDataCollectionActivity`, `DeviceDataCollector` — loan number, device ID, data collection for backend |
| **Backend communication** | `ApiClient`, `ApiEndpoints`, interceptors — registration, heartbeat, tamper, logs, bugs, installation status |

## Security Modes

- **STANDARD**: ADB/developer options allowed for support; factory reset and other critical actions blocked.
- **STRICT**: ADB and USB debugging blocked; maximum lockdown.

Mode is stored in `device_owner_config` and applied via `DeviceOwnerManager.applySecurityMode()`.

## Key Constraints

- **Minimum SDK**: API 31 (Android 12).
- **Device Owner** must be set via provisioning (e.g. QR code, `PROVISION_MANAGED_DEVICE`) so the app can apply user restrictions and system policies.
- **Foreground service**: Heartbeat runs inside `SecurityMonitorService` (foreground) to maintain a stable 30s interval when the app is in background or closed.

## Related Documentation

Docs are ordered so you can follow the flow from overview → features → setup → APIs → behavior → reference:

- [2.0 Features Implemented](2.0-FEATURES-IMPLEMENTED.md) — What the app does
- [3.0 Compatibility](3.0-COMPATIBILITY.md) — Device requirements
- [4.0 Device Installation](4.0-DEVICE-INSTALLATION.md) — Provisioning and installation
- [5.0 Device Registration](5.0-DEVICE-REGISTRATION.md) — Registration flow
- [6.0 APIs](6.0-APIS.md) — Backend endpoints reference
- [7.0 Device Heartbeat](7.0-DEVICE-HEARTBEAT.md) — Heartbeat mechanism
- [8.0 Hard Lock and Soft Lock](8.0-HARD-LOCK-AND-SOFT-LOCK.md) — Lock modes
- [9.0 Device Tamper](9.0-DEVICE-TAMPER.md) — Tamper detection and response
- [10.0 Local Databases](10.0-LOCAL-DATABASES.md) — Room and persistence
- [11.0 Device Logs and Bugs](11.0-DEVICE-LOGS-AND-BUGS.md) — Logging and bug reporting
- [12.0 Agent Update](12.0-AGENT-UPDATE.md) — Auto-update from GitHub
- [13.0 Services](13.0-SERVICES.md) — All configured Android services
- [14.0 Folder Structure](14.0-FOLDER-STRUCTURE.md) — Project layout
- [15.0 FRP](15.0-FRP.md) — Factory Reset Protection
- [16.0 Deactivation](16.0-DEACTIVATION.md) — Device Owner removal and deactivation
- [README](README.md) — Full documentation index and recommended reading order

**Next in sequence:** [2.0 Features Implemented](2.0-FEATURES-IMPLEMENTED.md)
