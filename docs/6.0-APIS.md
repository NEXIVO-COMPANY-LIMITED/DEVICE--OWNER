# 6.0 APIS

This document is a **reference** for all backend API endpoints used by the Device Owner app. Base URL is from **AppConfig.BASE_URL**.

---

## Overview

The app uses **Retrofit** and **ApiClient** / **ApiService** for HTTP calls. **ApiHeadersInterceptor** adds auth/device headers; **HtmlResponseInterceptor** detects HTML error responses (e.g. 404/500 from server) and can throw **ServerReturnedHtmlException**. Timeouts: connect/read/write 120s, call 240s. SSL: TLS 1.2+, hostname verification, optional certificate pinning.

---

## Device registration

| Method | Path | Request | Response | Description |
|--------|------|---------|----------|-------------|
| POST | `api/devices/mobile/register/` | DeviceRegistrationRequest (or flat map) | DeviceRegistrationResponse | Register device with loan number and device data; returns device_id. |

---

## Device data (heartbeat)

| Method | Path | Request | Response | Description |
|--------|------|---------|----------|-------------|
| POST | `api/devices/{deviceId}/data/` | HeartbeatRequest | HeartbeatResponse | Send heartbeat; server may return lock, deactivation, next_payment, tamper_indicators, etc. |

---

## Installation status

| Method | Path | Request | Response | Description |
|--------|------|---------|----------|-------------|
| POST | `api/devices/mobile/{deviceId}/installation-status/` | InstallationStatusRequest | InstallationStatusResponse | Report installation completed or failed. |

---

## Tamper

| Method | Path | Request | Response | Description |
|--------|------|---------|----------|-------------|
| POST | `api/tamper/mobile/{deviceId}/report/` | TamperEventRequest | TamperEventResponse | Report tamper event (tamper_type, severity, description, timestamp, extra_data). Response: locked (boolean). |

---

## Tech (logs and bugs)

| Method | Path | Request | Response | Description |
|--------|------|---------|----------|-------------|
| POST | `api/tech/devicecategory/logs/` | DeviceLogRequest | DeviceLogResponse | Send device log (deviceId, logType, message, logLevel, extraData). |
| POST | `api/tech/devicecategory/bugs/` | BugReportRequest | BugReportResponse | Send bug report (title, message, device, priority, etc.). |

---

## Endpoint constants (ApiEndpoints)

- `REGISTER_DEVICE_MOBILE` = "api/devices/mobile/register/"  
- `DEVICE_HEARTBEAT` = "api/devices/{deviceId}/data/"  
- `DEVICE_STATUS` = "api/devices/{deviceId}/status/" (if used)  
- `INSTALLATION_STATUS` = "api/devices/mobile/{deviceId}/installation-status/"  
- `DEVICE_LOGS` = "api/tech/devicecategory/logs/"  
- `BUG_REPORTS` = "api/tech/devicecategory/bugs/"  
- `TAMPER_REPORT` = "api/tamper/mobile/{deviceId}/report/"  
- `VALIDATE_LOAN` = "api/loans/{loanNumber}/validate/" (legacy, if exposed by backend)

---

## Request/response models (summary)

- **DeviceRegistrationRequest / Response**: loan_number, device data, device_id.  
- **HeartbeatRequest**: heartbeat_timestamp, device_id, android_id, model, manufacturer, serial_number, device_imeis, installed_ram, total_storage, location, security flags, device_info, android_info, imei_info, storage_info, etc.  
- **HeartbeatResponse**: success, message, content (reason, isLocked), deactivation, payment_complete, loan_complete, loan_status, management, next_payment, tamper_indicators, instructions, etc.  
- **InstallationStatusRequest / Response**: status (e.g. completed, failed).  
- **TamperEventRequest**: tamper_type, severity, description, timestamp, extra_data. **TamperEventResponse**: locked.  
- **DeviceLogRequest**: deviceId, logType, message, logLevel, extraData.  
- **BugReportRequest**: title, message, device, priority, extraData.

---

## Summary

| Area | Endpoints |
|------|-----------|
| Registration | POST register |
| Heartbeat | POST devices/{id}/data |
| Installation | POST installation-status |
| Tamper | POST tamper/mobile/{id}/report |
| Tech | POST logs, POST bugs |

Related: [5.0 Device Registration](5.0-DEVICE-REGISTRATION.md), [7.0 Device Heartbeat](7.0-DEVICE-HEARTBEAT.md), [9.0 Device Tamper](9.0-DEVICE-TAMPER.md), [11.0 Device Logs and Bugs](11.0-DEVICE-LOGS-AND-BUGS.md).
